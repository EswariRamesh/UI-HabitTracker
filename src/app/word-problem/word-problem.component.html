<!-- Show while waiting for API -->
<div *ngIf="loading" class="word-problem-wrapper">
  <h3>Loading quiz...</h3>
  <p>Please wait while we fetch your questions.</p>
</div>

<!-- Show questions or finished once data is loaded -->
<div *ngIf="!loading">
  <div class="word-problem-wrapper" *ngIf="currentIndex < problems.length; else finished">
    <h3>Question {{ currentIndex + 1 }} of {{ problems.length }}</h3>
    <p>{{ problems[currentIndex].question }}</p>

    <input
      [(ngModel)]="answer"
      type="text"
      placeholder="Type your answer"
      aria-label="Your answer"
      [disabled]="showFeedback"
    />

    <div class="btn-row">
      <button (click)="previous()" [disabled]="currentIndex === 0 || showFeedback" class="nav-btn">
        Previous
      </button>

      <button *ngIf="!showFeedback" (click)="submitAnswer()" [disabled]="!answer.trim()" class="submit-btn">
        âœ… Check my answer
      </button>

      <button *ngIf="showFeedback" (click)="nextQuestion()" class="nav-btn">
        Next
      </button>
    </div>

    <!-- Feedback message -->
    <div *ngIf="showFeedback" class="feedback-box" [ngClass]="{'correct': isCorrect, 'incorrect': !isCorrect}">
      <img *ngIf="isCorrect" src="assets/star.gif" alt="Star" class="star-img" />
      <span *ngIf="isCorrect">ðŸŽ‰ Great job! You got it right!</span>
      <span *ngIf="!isCorrect">
        Oops, not quite. The correct answer is <b>{{ problems[currentIndex].answer }}</b>.<br>
        Try the next one!
      </span>
    </div>
  </div>

  <!-- Congratulation summary screen -->
  <ng-template #finished>
    <div class="word-problem-wrapper finished">
      <img src="assets/congrats-cartoon.gif" alt="Congrats" class="congrats-img"/>
      <h3>Congratulations, {{ username }}! ðŸŽ‰</h3>
      <p>You completed the quiz. Your score: <b>{{ score }}</b></p>
      <div class="fun-message">
        Youâ€™re a Math Star! ðŸŒŸ<br>
        Keep learning and having fun!
      </div>
    </div>
  </ng-template>
</div>
